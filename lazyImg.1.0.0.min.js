/** Native image asynchronous loading lazyLoad, compatible with IE11, suitable for PC, mobile, framework, etc.
* Created 2019-05-23 v1
**/
(function(global,factory){typeof exports==="object"&&typeof module!=="undefined"?module.exports=factory():typeof define==="function"&&define.amd?define(factory):(global.LazyLoadImg=factory())}(this,(function(){var testMeet=function(el){var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var bcr=el.getBoundingClientRect();var mw=el.offsetWidth;var mh=el.offsetHeight;var w=window.innerWidth;var h=window.innerHeight;var boolX=!(bcr.right-options.left<=0&&bcr.left+mw-options.left<=0)&&!(bcr.left+options.right>=w&&bcr.right+options.right>=mw+w);var boolY=!(bcr.bottom-options.top<=0&&bcr.top+mh-options.top<=0)&&!(bcr.top+options.bottom>=h&&bcr.bottom+options.bottom>=mh+h);return el.width!=0&&el.height!=0&&boolX&&boolY};var canvas=document.createElement("canvas");canvas.getContext("2d").globalAlpha=0;var images={};var getTransparent=function(src,w,h){if(images[src]){return images[src]}canvas.width=w;canvas.height=h;var data=canvas.toDataURL("image/png");images[src]=data;return data};var classCallCheck=function(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}};var createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value" in descriptor){descriptor.writable=true}Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){if(protoProps){defineProperties(Constructor.prototype,protoProps)}if(staticProps){defineProperties(Constructor,staticProps)}return Constructor}}();var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};var LazyLoadImg=function(){function LazyLoadImg(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};classCallCheck(this,LazyLoadImg);this.options={el:null,mode:"default",time:300,complete:true,diy:{backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center center"},position:{top:0,right:0,bottom:0,left:0},before:function before(){},success:function success(){},error:function error(){}};
options.position=_extends({},this.options.position,options.position);options.diy=_extends({},this.options.diy,options.diy);_extends(this.options,options);this._timer=true;this.start()}createClass(LazyLoadImg,[{key:"start",value:function start(){var _this=this;var options=this.options;clearTimeout(this._timer);if(!this._timer){return}this._timer=setTimeout(function(){var list=Array.prototype.slice.apply(options.el.querySelectorAll("[data-src]"));if(!list.length&&options.complete){return clearTimeout(_this._timer)}else{list.forEach(function(el){if(!el.dataset.LazyLoadImgState&&testMeet(el,options.position)){_this.loadImg(el)}})}_this.start()},options.time)}},{key:"loadImg",value:function loadImg(el){var _this2=this;var options=this.options;el.dataset.LazyLoadImgState="start";options.before.call(this,el);var img=new Image();img.src=el.dataset.src;img.addEventListener("load",function(){if(options.mode=="diy"){el.src=getTransparent(el.src,el.width,el.height);options.diy.backgroundImage="url("+img.src+")";_extends(el.style,options.diy)}else{el.src=img.src}delete el.dataset.src;el.dataset.LazyLoadImgState="success";return options.success.call(_this2,el)},false);img.addEventListener("error",function(){delete el.dataset.src;el.dataset.LazyLoadImgState="error";options.error.call(_this2,el)},false)}},{key:"destroy",value:function destroy(){delete this._timer}}]);return LazyLoadImg}();return LazyLoadImg})));